---
- hosts: all
  gather_facts: yes
  tasks:
      - name: Download zabbix repo package
        get_url:
            url: https://repo.zabbix.com/zabbix/6.0/ubuntu/pool/main/z/zabbix-release/zabbix-release_6.0-4%2Bubuntu20.04_all.deb
            dest: /tmp/zabbix.deb

      - name: Install zabbix repo
        become: yes
        apt:
            deb: /tmp/zabbix.deb
            state: present

      - name: Install zabbix agent
        become: yes
        apt:
            name: zabbix-agent
            state: present
            update_cache: yes

      - name: Enable service zabbix-agent
        become: yes
        service:
            name: zabbix-agent
            boolean: true


      - name: Start service zabbix-agent
        become: yes
        service:
            name: zabbix-agent
            state: started
